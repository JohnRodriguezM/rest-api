"use strict";const d=document;import{helpHTTP}from"../helpers/helpHTTPS.mjs";const exeHelHTTP=helpHTTP(),DOMElements={text:d.getElementById("textoInput"),submit:d.getElementById("submit"),form:d.getElementById("form"),containerApi:d.querySelector(".contenedor"),containerFavs:d.querySelector(".containerFavorites"),btnAleatorio:d.getElementById("aleatorio"),fragment:d.createDocumentFragment(),secondFragment:d.createDocumentFragment(),$template:d.getElementById("crud-template-perritosBasic").content,$templateFavs:d.getElementById("crudfavoritos").content},{containerApi:containerApi,parrafo:parrafo,$template:$template,fragment:fragment,$templateFavs:$templateFavs,containerFavs:containerFavs,secondFragment:secondFragment,text:text,form:form}=DOMElements,errorHandling=e=>{if(!e.ok)throw{status:e.status,ok:e.ok}},getData=async e=>{try{let e=`https://api.thedogapi.com/v1/images/search?limit=${text.value||2}`,t=await exeHelHTTP.get(e);0===t.length&&(parrafo.innerHTML="cargando"),t.map(e=>{$template.querySelector(".img-perritos").src=e.url,$template.querySelector(".addDog").dataset.id=e.id;let t=d.importNode($template,!0);fragment.appendChild(t)}),containerApi.appendChild(fragment),form.reset()}catch(e){console.log(e),location.href="error.html"}},getFavorites=async()=>{try{const e="https://api.thedogapi.com/v1/favourites";let t=await fetch(e,{method:"GET",headers:{"X-API-KEY":"ce0e512f-9d50-41e8-9c8b-216fb89807a8"}});errorHandling(t),(await t.json()).map(e=>{let t=$templateFavs.querySelector(".delete");$templateFavs.querySelector(".favorites").src=e.image.url,t.dataset.id=e.id;let a=d.importNode($templateFavs,!0);secondFragment.appendChild(a)}),containerFavs.appendChild(secondFragment)}catch(e){}};export const postDog=async e=>{try{const t="https://api.thedogapi.com/v1/favourites",a={method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","x-api-key":"ce0e512f-9d50-41e8-9c8b-216fb89807a8"},body:JSON.stringify({image_id:e})};let o=await fetch(t,a);errorHandling(o),console.log(o);let r=await o.json();console.log(r),location.reload()}catch(e){}};const deleteDog=e=>{if(e.target.matches(".delete")){let t=e.target.dataset.id,a="https://api.thedogapi.com/v1/favourites/";try{const o={method:"DELETE",headers:{"x-api-key":"ce0e512f-9d50-41e8-9c8b-216fb89807a8"}};confirm("Are you sure you want to delete")&&(fetch(`${a}${t}`,o),e.path[2].style.display="none")}catch(e){}}};d.addEventListener("DOMContentLoaded",getData),form.addEventListener("submit",e=>{e.preventDefault(),getData()}),d.addEventListener("DOMContentLoaded",e=>{getFavorites()}),d.addEventListener("click",e=>{e.target.matches(".addDog")&&postDog(e.target.dataset.id)}),d.addEventListener("click",e=>deleteDog(e));